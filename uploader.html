<html>
    <head>
        <title>Uploading Files to S3</title>

        <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.12.min.js"></script>

	<link rel="stylesheet" href="css/uploader.css"/>
    </head>

    <body>
        <p>Upload sermon audio</p>

	<div class="sermon">
            <input type="file" id="fileinput" accept="audio/*"/>
            <button id="remove-button" class="right">Remove File</button>
            <button id="upload-button" class="right">Upload</button>
	    <p id="results"></p>
	</div>

        <script type="text/javascript">
         var bucketName = 'isaac-wfth';
         var fileInput = document.getElementById('fileinput');
         var uploadButton = document.getElementById('upload-button');
         var removeButton = document.getElementById('remove-button');
         var results = document.getElementById('results');

         var credsString = readFile("creds.txt");
         var credsArr = credsString.split(",");

         AWS.config.region = 'us-east-1';
         var bucket = new AWS.S3({
             params: {
                 Bucket: bucketName
             },
             accessKeyId: credsArr[0],
             secretAccessKey: credsArr[1]
         })

         uploadButton.addEventListener('click', function() {
             var file = fileInput.files[0];
             if (file) {
                 results.innerHTML = "Uploading...";
                 var params = { Key: file.name, ContentType: file.type, Body: file, ACL: 'public-read' }
                 bucket.putObject(params, function(err, data) {
                     if (err) {
                         results.innerHTML = err;
                     } else {
                         results.innerHTML = "File successfully uploaded";
                     }
                 })
             } else {
                 results.innerHTML = "No file selected";
             }
         }, false);

         removeButton.addEventListener('click', function() {
             fileInput.value = "";
         }, false);

         // called whenever the user changes the selected file
         document.getElementById('fileinput').addEventListener('change', function() {
             var file = this.files[0];
             console.log("name : " + file.name);
             console.log("file size : " + file.size);
         }, false);

         function readFile(file) {
             var request = new XMLHttpRequest();
             request.open("GET", file, false);
             request.send(null);

             return request.responseText;
         }
        </script>
    </body>
</html>
